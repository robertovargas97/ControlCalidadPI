
@{
    ViewBag.Title = "Index";
}

@{


    List<SelectListItem> projectsNames = (List<SelectListItem>)ViewBag.allprojects;
    List<SelectListItem> testerNames = (List<SelectListItem>)ViewBag.alltesters;

    if (User.IsInRole("Jefe"))
    {
        <div class="row">
            <div class="col s4">
                <div class="card hoverable">
                    <nav>
                        <div class="nav-wrapper  black">
                            <p class="col s4">Reportes</p>
                        </div>
                    </nav>
                    <div class="card-content black-text">
                        <div class="row">
                            <div class="col s12">
                                <div class="col s12 margin-b1">
                                    <input type="button" class="black-text btn grey  turq-hover background-color:grey" name="answer" value="Requerimientos terminados" onclick="showProjects1()" />
                                </div>

                                <div class="col s12">
                                    <hr />
                                    <br />
                                </div>

                                <div class="col s12 margin-b1">
                                    <input type="button" class="black-text btn grey  turq-hover" name="answer" value="Requerimientos en ejecución" onclick="showProjects2()" />
                                </div>

                                <div class="col s12">
                                    <hr />
                                    <br />
                                </div>

                                <div class="col s12 margin-b1">
                                    <input type="button" class="black-text btn grey  turq-hover" name="answer" value="Cantidad de requerimientos por tester" onclick="showProjects3()" />
                                </div>

                                <div class="col s12">
                                    <hr />
                                    <br />
                                </div>

                                <div class="col s12 margin-b1">
                                    <input type="button" class="black-text btn grey  turq-hover" name="answer" value="Historial de participación" onclick="showProjects4()" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col s8">
                <div class="card hoverable">
                    <nav id="nav">
                        <div class="nav-wrapper grey">
                            <div>
                                <p class="col s9">Resultados</p>
                            </div>
                        </div>
                    </nav>
                    <nav id="nav1" style="display:none;">
                        <div class="nav-wrapper grey">
                            <div>
                                <p class="col s9">Requerimientos terminados</p>
                                <form action="Edit">
                                    <input type="text" id="ability" placeholder="Buscar por . . ." style="width: 12%;">
                                    <a class="waves-effect waves-light btn  black turq-hover">Buscar</a>
                                </form>
                            </div>
                        </div>
                    </nav>
                    <nav id="nav2" style="display:none;">
                        <div class="nav-wrapper grey">
                            <div>
                                <p class="col s9">Requerimientos en ejecución</p>
                                <form action="Edit">
                                    <input type="text" id="ability" placeholder="Buscar por . . ." style="width: 12%;">
                                    <a class="waves-effect waves-light btn  black turq-hover">Buscar</a>
                                </form>
                            </div>
                        </div>
                    </nav>
                    <nav id="nav3" style="display:none;">
                        <div class="nav-wrapper grey">
                            <div>
                                <p class="col s9">Cantidad de requerimientos por tester</p>
                                <form action="Edit">
                                    <input type="text" id="ability" placeholder="Buscar por . . ." style="width: 12%;">
                                    <a class="waves-effect waves-light btn  black turq-hover">Buscar</a>
                                </form>
                            </div>
                        </div>
                    </nav>
                    <nav id="nav4" style="display:none;">
                        <div class="nav-wrapper grey">
                            <div>
                                <p class="col s9">Historial de participación</p>
                                <form action="Edit">
                                    <input type="text" id="ability" placeholder="Buscar por . . ." style="width: 12%;">
                                    <a class="waves-effect waves-light btn  black turq-hover">Buscar</a>
                                </form>
                            </div>
                        </div>
                    </nav>


                    <div class="card-content black-text">
                        <div class="row">
                            <div class="col s12">
                                <div class="col s12 margin-b2">
                                    <div id="selectProject1" style="display:none;" class="answer_list">
                                        @Html.DropDownList("proy1", projectsNames, "Seleccione un proyecto", new { @onchange = "firstReport()" })
                                        <br />
                                        <div>
                                            <table class="table striped ">
                                                <thead>
                                                    <tr>
                                                        <th class="center black white-text">
                                                            Nombre
                                                        </th>
                                                        <th class="center black white-text">
                                                            Estado
                                                        </th>
                                                        <th class="center black white-text">
                                                            Complejidad
                                                        </th>
                                                        <th class="center black white-text">
                                                            Responsable
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody id="table1" class="center">
                                                    
                                                </tbody>
                                            </table>
                                        </div>

                                    </div>
                                </div>



                                <div class="col s12 margin-b2">
                                    <div id="selectProject2" style="display:none;" class="answer_list">
                                        @Html.DropDownList("proy2", projectsNames, "Seleccione un proyecto", new { @onChange = "secondReport()" })
                                        <br />
                                        <table class="table striped ">
                                            <thead>
                                                <tr>
                                                    <th class="center black white-text">
                                                        Nombre
                                                    </th>
                                                    <th class="center black white-text">
                                                        Complejidad
                                                    </th>
                                                    <th class="center black white-text">
                                                        Responsable
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody id="table2" class="center ">

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="col s12 margin-b2">
                                    <div id="selectProject3" style="display:none;" class="answer_list">
                                        @Html.DropDownList("proy3", projectsNames, "Seleccione un proyecto", new { @onChange = "thirdReport()" })
                                        <br />
                                        <table  class="table striped ">
                                            <thead>
                                                <tr>
                                                    <th class="center black white-text">
                                                        Tester
                                                    </th>
                                                    <th class="center black white-text">
                                                        Cantidad
                                                    </th>
                                                    <th class="center black white-text">
                                                        Proyecto
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody id="table3" class="center">

                                            </tbody>

                                        </table>
                                        <div id="chart_div"></div>
                                    </div>
                                </div>
                                <div class="col s12 margin-b2">
                                    <div id="selectProject4" style="display:none;" class="answer_list">
                                        @Html.DropDownList("tester", testerNames, "Seleccione un tester", new { @onChange = "fourthReport()" })
                                        <br />
                                        <table id="table4" class="table striped ">
                                            <thead>
                                                <tr>
                                                    <th class="center black white-text">
                                                        Nombre del Proyecto
                                                    </th>
                                                    <th class="center black white-text">
                                                        Estado del Proyecto
                                                    </th>
                                                    <th class="center black white-text">
                                                        Horas Dedicadas
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody id="table4" class="center"></tbody>
                                        </table>

                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    }
    else
    {
        <div class="row container center top-m-block">
            <div class="card hoverable s10 section">
                <h3>Lo sentimos.<br />Debes iniciar sesión como <span class="red-text"> jefe </span> para ingresar a la sección de Reportes.</h3>
                <i class="large material-icons red-text">block</i>
            </div>
        </div>
    }


}



@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/materializeD")
    @Scripts.Render("~/bundles/bootstrap")
    @Scripts.Render("~/bundles/ajax")
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', { packages: ['corechart'] });
        google.charts.setOnLoadCallback(showProject3);
    </script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="objects.js"></script> 
    <script>
        function firstReport() {
            var proy = document.getElementById('proy1').value;
            $.get("/Reports/CompletedRequirements", { proy: proy }, function (data) {
                $.each(data, function (index, v1) {
                    $("#table1").append("<tr><td>" + v1.nombreRequerimiento + "</td><td>" + v1.estadoRequerimiento + "</td><td>" +  v1.complejidadRequerimiento + "</td><td>" +  v1.nombreResponsable + "</td><tr>");
                });
            });
        }

    </script>
    <script>
        function secondReport() {
            var proy2 = document.getElementById('proy2').value
            $.get("/Reports/RunningRequirements", { proy: proy2 }, function (data) {
                $.each(data, function (index, v2) {
                    $("#table2").append("<tr ><td>" + v2.nombreReq + "</td><td>" + v2.complejidadReq + "</td><td>" + v2.nombreResp + "</td><td>");
                });
            });
        }
    </script>
    <script>
        function thirdReport() {
            var proy3 = document.getElementById('proy3').value
            $.get("/Reports/TesterRequirements", { proy: proy3 }, function (data) {
                $.each(data, function (index, v3) {
                    $("#table3").append("<tr><td>" + v3.nombreTester + "</td><td>" + v3.cantidadReqAsignados + "</td><td>" + v3.nombreP + "</td><td>");
                    var data = google.visualization.arrayToDataTable([
                        ['Elemento', 'Cantidad', { role: 'style' }],
                        [v3.nombreTester, v3.cantidadReqAsignados, 'blue'],
                    ]);


                    var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
                    chart.draw(data);
                });
            });
        }
    </script>
    <script>
        function fourthReport() {
            var tester = document.getElementById('tester').value
            $.get("/Reports/ParticipationHistory", { tester: tester }, function (data) {
                var row;
                $.each(data, function (index, v4) {
                    $("#table4").append("<tr><td>" + v4.nombre + "</td><td>" + v4.estado + "</td><td>" + v4.horasDedicas + "</td><td>");
                });
            });
        }
    </script>

    <script>
        function showProjects1() {
            document.getElementById('nav').style.display = "none";
            document.getElementById('nav2').style.display = "none";
            document.getElementById('nav3').style.display = "none";
            document.getElementById('nav4').style.display = "none";
            document.getElementById('nav1').style.display = "block";
            document.getElementById('selectProject2').style.display = "none";
            document.getElementById('selectProject3').style.display = "none";
            document.getElementById('selectProject4').style.display = "none";
            document.getElementById('selectProject1').style.display = "block";

        }
    </script>
    <script>
        function showProjects2() {
            document.getElementById('nav').style.display = "none";
            document.getElementById('nav1').style.display = "none";
            document.getElementById('nav3').style.display = "none";
            document.getElementById('nav4').style.display = "none";
            document.getElementById('nav2').style.display = "block";
            document.getElementById('selectProject1').style.display = "none";
            document.getElementById('selectProject3').style.display = "none";
            document.getElementById('selectProject4').style.display = "none";
            document.getElementById('selectProject2').style.display = "block";
        }
    </script>
    <script>
        function showProjects3() {
            document.getElementById('nav').style.display = "none";
            document.getElementById('nav1').style.display = "none";
            document.getElementById('nav2').style.display = "none";
            document.getElementById('nav4').style.display = "none";
            document.getElementById('nav3').style.display = "block";
            document.getElementById('selectProject1').style.display = "none";
            document.getElementById('selectProject2').style.display = "none";
            document.getElementById('selectProject4').style.display = "none";
            document.getElementById('selectProject3').style.display = "block";
        }
    </script>
    <script>
        function showProjects4() {
            document.getElementById('nav').style.display = "none";
            document.getElementById('nav1').style.display = "none";
            document.getElementById('nav2').style.display = "none";
            document.getElementById('nav3').style.display = "none";
            document.getElementById('nav4').style.display = "block";
            document.getElementById('selectProject1').style.display = "none";
            document.getElementById('selectProject2').style.display = "none";
            document.getElementById('selectProject3').style.display = "none";
            document.getElementById('selectProject4').style.display = "block";
        }
    </script>



}